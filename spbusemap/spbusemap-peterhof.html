<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <style type="text/css">
    p, h2 {
      font-family: Verdana,Lucida,Helvetica,Arial,sans-serif;
    }
    h2 {
      font-weight: bold;
      font-size: 16px;
      background-color: lightgrey;
      color: black;

      margin: 0px;
      text-align: center;
      border-radius: 3px;
      width: 100%;
    }
    p {
      font-size: 12px;
    }

    .olPopup {
      border-radius: 6px;
      border: none;
      overflow: hidden;
    }
  </style>
  <!--[if lt IE 9]>
  <style>
    h2 {
      width: 190px;
    }
  </style>
  <![endif]-->
  <!--[if gte IE 9]>
  <style>
    h2 {
      width: 200px;
    }
  </style>
  <![endif]-->
</head>
<body onload="initM();">
<!-- div style="width: 100%;" id="log"></div-->
<div id="spbuSeMap" style="width: 600px; height: 600px; margin: 1;"></div>
<script type="text/javascript" src="http://openlayers.org/dev/OpenLayers.js"></script>
<script type="text/javascript">
  function initM() {

    // tuning
    {
      function print(st) {
        //document.getElementById("log").innerHTML += ("" + st + "<br/>");
      }
     
      var IE = (navigator.appName == 'Microsoft Internet Explorer');
      print("IE: " + IE);

      var oldIE = false;
      if(IE) {
        var version = 999; // we assume a sane browser
        if (navigator.appVersion.indexOf("MSIE") != -1)
        // bah, IE again, lets downgrade version number
        version = parseFloat(navigator.appVersion.split("MSIE")[1]);
        if(version <= 7)
          oldIE = true;
      }
      print("IE <= 7: " + oldIE);


      if(!oldIE) {
        OpenLayers.Popup.OPACITY = 0.8;
        OpenLayers.Popup.BORDER = "1px solid darkgrey";
      }

      var oocl = OpenLayers.Popup.prototype.onclick;
      OpenLayers.Popup.prototype.onclick = function (evt) {
        this.toggle();
        oocl(evt);
      }
    }

    var map = new OpenLayers.Map("spbuSeMap");
    var mapnik         = new OpenLayers.Layer.OSM();
    var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
    var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
    var position       = new OpenLayers.LonLat(29.82916,59.8815).transform( fromProjection, toProjection);
    var zoom           = 15; 

    // map
    map.addLayer(mapnik);
    map.setCenter(position, zoom );

    // footpath
    var fp = new OpenLayers.Layer.GML("Пешком до и от Матмеха", "spbusewalk.gpx", {
	format: OpenLayers.Format.GPX,
	style: {strokeColor: "blue", strokeWidth: 5, strokeOpacity: 0.5},
	projection: map.displayProjection
    });
    map.addLayer(fp);

    // autopath
    var ap = new OpenLayers.Layer.GML("На автомобиле до и от Матмеха", "spbuseride.gpx", {
	format: OpenLayers.Format.GPX,
	style: {strokeColor: "red", strokeWidth: 5, strokeOpacity: 0.5},
	projection: map.displayProjection
    });
    map.addLayer(ap);

    // railpath
    var rp = new OpenLayers.Layer.GML("На электричке до и от ПУНК СПбГУ", "spbuserail.gpx", {
	format: OpenLayers.Format.GPX,
	style: {strokeColor: "green", strokeWidth: 5, strokeOpacity: 0.5},
	projection: map.displayProjection
    });
    map.addLayer(rp);

    // trampath
    var tp = new OpenLayers.Layer.GML("На трамвае №36 до Стрельны", "spbusetram.gpx", {
	format: OpenLayers.Format.GPX,
	style: {strokeColor: "yellow", strokeWidth: 5, strokeOpacity: 0.7, strokeDashstyle: "dash"},
	projection: map.displayProjection
    });
    map.addLayer(tp);

    // points
    var pois = new OpenLayers.Layer.Text("Точки на карте",
                    { location:"./spbusepoi.csv",
                      projection: map.displayProjection,
                      'autoSize': true
                    });
    map.addLayer(pois);
    map.addControl(new OpenLayers.Control.LayerSwitcher());
  }
</script>
</body>
</html>
