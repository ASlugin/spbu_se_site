{% extends "account/base_account.html" %}

{% block title %}Главная{% endblock %}

{% block content_account %}

<div class="container">

    <div class="row">
        <div class="col">
            <h5 class="align-right">Главная</h5>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <ul class="nav nav-tabs mb-3">
                {% if type_notifications == "new" %}
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('account_index', notifications='new') }}">Новые уведомления</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('account_index', notifications='all') }}">Все уведомления</a>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('account_index', notifications='new') }}">Новые уведомления</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('account_index', notifications='all') }}">Все уведомления</a>
                </li>
                {% endif %}
            </ul>

            <form name="read_buttons_form" method="POST" action="{{ url_for('account_index', notifications=type_notifications) }}">
                <input id="hiddenReadButton" type="hidden" name="read_button" value="0"/>

                {% if type_notifications == "new" %}
                {% for notification in notifications %}
                {% if not notification.viewed %}
                <div class="card mb-2">
                    <div class="card-body pt-3 pb-3">

                        <div class="row">
                            <div class="col">
                                {{ notification }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <span class="badge badge-secondary">
                                    {{ notification.time | datatime_convert }}
                                </span>
                            </div>
                            <div class="col d-flex justify-content-end">
                                <a href="" onClick="document.getElementById('hiddenReadButton').value = {{notification.id}}; read_buttons_form.submit(); return false;">
                                    <span id="span{{notification.id}}" class="badge btn-primary" style="display: inline-block;"
                                      onmouseover="changeBadge('span{{notification.id}}');"
                                      onmouseout="changeBadgeBack('span{{notification.id}}');">
                                    Не прочитано
                                    </span>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
                {% endif %}
                {% endfor %}
                {% else %}
                    {% for notification in notifications %}
                    <div class="card mb-2">
                        <div class="card-body pt-3 pb-3">
                            <div class="row">
                                <div class="col">
                                    {{ notification }}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <span class="badge badge-secondary">
                                        {{ notification.time | datatime_convert }}
                                    </span>
                                </div>
                                {% if notification.viewed %}
                                <div class="col d-flex justify-content-end">
                                    <span class="badge badge-success" style="display: inline-block; width: 103px">
                                        Прочитано
                                    </span>
                                </div>
                                {% else %}
                                <div class="col d-flex justify-content-end">
                                    <a href="" onClick="document.getElementById('hiddenReadButton').value = {{notification.id}}; read_buttons_form.submit(); return false;">
                                        <span id="span{{notification.id}}" class="badge btn-primary" style="display: inline-block;"
                                          onmouseover="changeBadge('span{{notification.id}}');"
                                          onmouseout="changeBadgeBack('span{{notification.id}}');">
                                        Не прочитано
                                        </span>
                                    </a>
                                </div>
                                {% endif %}
                            </div>

                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </form>
        </div>
    </div>
    
</div>

<script type="text/javascript">
    function changeBadge(id)
    {
        span = document.getElementById(id);
        let widthSpan = span.offsetWidth;
        span.textContent = 'Прочитано';
        span.style.width = widthSpan.toString() + "px";
        span.className = "badge btn-success";
    }
    function changeBadgeBack(id)
    {
        span = document.getElementById(id);
        span.textContent = 'Не прочитано';
        span.className = "badge btn-primary";
    }
</script>

{% endblock %}